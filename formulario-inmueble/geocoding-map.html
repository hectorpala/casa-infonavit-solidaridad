<!DOCTYPE html>
<html lang="es" class="antialiased selection:bg-fuchsia-100 selection:text-fuchsia-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geocodificaci√≥n con Mapa | Cotizador de Inmuebles</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Herramienta de geocodificaci√≥n para obtener coordenadas exactas de propiedades en Culiac√°n y Mazatl√°n, Sinaloa.">
    <meta name="keywords" content="geocodificaci√≥n, mapa, coordenadas, direcci√≥n, Culiac√°n, Mazatl√°n">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">

    <!-- Google Fonts - Inter for UI -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet CSS (OpenStreetMap) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/main.css?v=20250103">
    <link rel="stylesheet" href="css/form.css?v=20250103">
    <link rel="stylesheet" href="css/geocoding-map.css?v=1762324026">
    <link rel="stylesheet" href="css/geocoding-map-modern.css?v=20251106">
    <link rel="stylesheet" href="css/search-history.css?v=20251106">
    <!-- POI nearby CSS removed -->
    <link rel="stylesheet" href="css/property-marker-3d.css?v=20251106">
    <link rel="stylesheet" href="css/saved-markers.css?v=20251106">
    <link rel="stylesheet" href="css/tagged-properties-panel.css?v=20251107">

    <style>
        /* üé® Design Tokens - Sistema de dise√±o s√≥lido y consistente */
        :root {
            /* Colores base */
            --bg: #ffffff;
            --bg-muted: #fafafa;
            --fg: #0a0a0a;
            --fg-muted: #525252;
            --fg-subtle: #a1a1aa;

            /* Accent (fuchsia) */
            --accent: #c026d3;
            --accent-600: #a21caf;
            --accent-100: #fae8ff;

            /* Estados */
            --ok: #16a34a;
            --warn: #eab308;
            --err: #dc2626;
            --info: #2563eb;

            /* Bordes */
            --brd: #e4e4e7;
            --brd-strong: #d4d4d8;

            /* Sombras (escala de elevaci√≥n) */
            --shadow: 0 1px 2px rgba(0,0,0,.06), 0 8px 24px rgba(0,0,0,.06);
        }

        /* Additional inline styles for enhanced visual hierarchy */
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f5f5f5;
        }

        ::-webkit-scrollbar-thumb {
            background: #d4d4d4;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a3a3a3;
        }

        /* üì± UX Mobile: Mejorar tap area de marcadores */
        .leaflet-marker-icon {
            cursor: pointer;
            /* √Årea t√°ctil m√≠nima 44x44px (Apple HIG) */
            min-width: 44px !important;
            min-height: 44px !important;
        }

        /* Popup personalizado */
        .leaflet-popup.property-popup {
            /* Asegurar legibilidad en mobile */
            font-size: 14px;
        }

        .leaflet-popup.property-popup .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            padding: 0;
        }

        .leaflet-popup.property-popup .leaflet-popup-content {
            margin: 0;
            line-height: 1.5;
        }

        /* Bot√≥n de cerrar m√°s grande en mobile */
        @media (max-width: 768px) {
            .leaflet-popup-close-button {
                width: 32px !important;
                height: 32px !important;
                font-size: 24px !important;
                line-height: 32px !important;
                padding: 4px !important;
            }
        }

        /* Marcadores guardados con √°rea t√°ctil c√≥moda */
        .saved-property-marker {
            /* √Årea t√°ctil amplia */
            padding: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .saved-property-marker:hover,
        .saved-property-marker:active {
            transform: scale(1.1);
        }

        /* üìù UTILIDADES DE INPUTS - Estados y feedback visual */
        /* Base input */
        .input {
            height: 44px;
            width: 100%;
            border-radius: 12px;
            border-width: 1px;
            background-color: var(--bg);
            padding-left: 12px;
            padding-right: 12px;
            color: var(--fg);
            transition: all 0.2s;
        }
        .input::placeholder {
            color: var(--fg-subtle);
        }

        /* Estados de input */
        .input--default {
            border-color: var(--brd);
        }
        .input--default:focus {
            outline: none;
            border-color: var(--accent);
            ring: 4px;
            ring-color: var(--accent-100);
        }

        .input--success {
            border-color: var(--ok);
        }
        .input--success:focus {
            outline: none;
            ring: 4px;
            ring-color: rgb(16 163 74 / 0.1);
        }

        .input--warn {
            border-color: var(--warn);
        }
        .input--warn:focus {
            outline: none;
            ring: 4px;
            ring-color: rgb(234 179 8 / 0.1);
        }

        .input--error {
            border-color: var(--err);
        }
        .input--error:focus {
            outline: none;
            ring: 4px;
            ring-color: rgb(220 38 38 / 0.1);
        }

        /* Mensajes de feedback */
        .hint {
            margin-top: 4px;
            font-size: 11px;
            line-height: 1.4;
            color: var(--fg-subtle);
        }

        .msg-success {
            margin-top: 4px;
            font-size: 12px;
            line-height: 1.4;
            color: var(--ok);
        }

        .msg-warn {
            margin-top: 4px;
            font-size: 12px;
            line-height: 1.4;
            color: var(--warn);
        }

        .msg-error {
            margin-top: 4px;
            font-size: 12px;
            line-height: 1.4;
            color: var(--err);
        }

        /* M√°scara visual para CP */
        .mask-cp::placeholder {
            letter-spacing: 0.08em;
        }

        /* Input con icono (padding left ajustado) */
        .input-with-icon {
            padding-left: 36px;
        }

        /* üìã PANEL DE RESULTADOS - Filas y estados */

        /* Fila seleccionada (sincronizada con pin) */
        .result-row--selected {
            background-color: var(--accent-100) !important;
            border-left: 2px solid var(--accent);
        }

        /* Scroll suave en panel de resultados */
        #results-list {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar para panel de resultados */
        #results-list::-webkit-scrollbar {
            width: 6px;
        }

        #results-list::-webkit-scrollbar-track {
            background: var(--bg-muted);
        }

        #results-list::-webkit-scrollbar-thumb {
            background: var(--brd-strong);
            border-radius: 3px;
        }

        #results-list::-webkit-scrollbar-thumb:hover {
            background: var(--fg-subtle);
        }

        /* üó∫Ô∏è MAPA PREMIUM - Pins, clusters, popups y controles */

        /* Pin base del mapa */
        .map-pin {
            width: 14px;
            height: 14px;
            border-radius: 9999px;
            background: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-100), 0 6px 16px rgba(0, 0, 0, 0.18);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        /* Pin seleccionado */
        .map-pin--selected {
            background: var(--accent-600);
            box-shadow: 0 0 0 4px var(--accent-100), 0 10px 24px rgba(0, 0, 0, 0.24);
            transform: scale(1.05);
        }

        /* Pin con pulso */
        .map-pin--pulse {
            position: relative;
        }
        .map-pin--pulse::after {
            content: "";
            position: absolute;
            inset: -6px;
            border-radius: 9999px;
            border: 2px solid var(--accent-100);
            animation: pulse-map 1.6s infinite;
            opacity: 0.8;
        }

        @keyframes pulse-map {
            0% {
                transform: scale(0.9);
                opacity: 0.9;
            }
            100% {
                transform: scale(1.2);
                opacity: 0;
            }
        }

        /* Pin hover */
        .map-pin:hover {
            transform: scale(1.05);
            box-shadow: 0 0 0 4px var(--accent-100), 0 8px 20px rgba(0, 0, 0, 0.22);
        }

        /* Pin focus (teclado) */
        .map-pin:focus {
            outline: 3px solid var(--accent-100);
            outline-offset: 2px;
        }

        /* Pin dragging */
        .map-pin--dragging {
            cursor: grabbing !important;
            box-shadow: 0 0 0 4px var(--accent-100), 0 12px 28px rgba(0, 0, 0, 0.28);
            transform: scale(1.1);
        }

        /* Clusters por densidad */
        .cluster {
            display: grid;
            place-items: center;
            width: 32px;
            height: 32px;
            border-radius: 9999px;
            color: #fff;
            font: 600 12px/1.1 system-ui;
            box-shadow: 0 8px 22px rgba(0, 0, 0, 0.22);
            transition: transform 0.2s;
            cursor: pointer;
        }

        .cluster:hover {
            transform: scale(1.08);
        }

        .cluster--low {
            background: #8b5cf6;  /* Violeta - pocos */
        }

        .cluster--mid {
            background: var(--accent);  /* Fuchsia - medios */
        }

        .cluster--high {
            background: #ea580c;  /* Naranja - muchos */
        }

        /* Popups minimalistas coherentes */
        .leaflet-popup-content-wrapper {
            padding: 0 !important;
            border-radius: 14px !important;
            border: 1px solid var(--brd) !important;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06), 0 12px 28px rgba(0, 0, 0, 0.12) !important;
            overflow: hidden !important;
        }

        .leaflet-popup-tip {
            background: var(--bg) !important;
            border: 1px solid var(--brd) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
        }

        .leaflet-popup-content {
            margin: 0 !important;
        }

        /* Controles del mapa (zoom, etc) */
        .leaflet-control-zoom,
        .leaflet-bar {
            backdrop-filter: saturate(180%) blur(6px) !important;
            background: rgba(255, 255, 255, 0.9) !important;
            border: 1px solid var(--brd) !important;
            border-radius: 12px !important;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12) !important;
        }

        .leaflet-control-zoom a,
        .leaflet-bar a {
            width: 36px !important;
            height: 36px !important;
            line-height: 36px !important;
            display: grid !important;
            place-items: center !important;
            color: var(--fg) !important;
            border: none !important;
            transition: all 0.2s !important;
        }

        .leaflet-control-zoom a:hover,
        .leaflet-bar a:hover {
            background: var(--bg-muted) !important;
            color: var(--accent) !important;
        }

        .leaflet-control-zoom a:first-child {
            border-radius: 12px 12px 0 0 !important;
        }

        .leaflet-control-zoom a:last-child {
            border-radius: 0 0 12px 12px !important;
        }

        /* Overlay de precisi√≥n (c√≠rculo radial) */
        .precision-overlay {
            width: 180px;
            height: 180px;
            border-radius: 9999px;
            background: var(--accent);
            opacity: 0.12;
            border: 1px solid #f5d0fe;
            pointer-events: none;
        }

        /* Modo compacto m√≥vil */
        @media (max-width: 768px) {
            .map-pin {
                width: 12px;
                height: 12px;
                box-shadow: 0 0 0 2px var(--accent-100), 0 4px 12px rgba(0, 0, 0, 0.16);
            }

            .cluster {
                width: 28px;
                height: 28px;
                font-size: 11px;
            }

            .leaflet-control-zoom a,
            .leaflet-bar a {
                width: 32px !important;
                height: 32px !important;
                line-height: 32px !important;
            }
        }

        /* Marcadores guardados premium */
        .leaflet-marker-icon {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .leaflet-marker-icon:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.2));
        }
    </style>
</head>
<body class="bg-[color:var(--bg)] text-[color:var(--fg)] text-[clamp(15px,1.6vw,16px)] leading-[1.55] tracking-[0.005em] font-sans">
    <!-- HEADER STICKY COMPACTO -->
    <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/75 bg-white/95 border-b border-[color:var(--brd)] shadow-sm">
        <div class="mx-auto max-w-[1100px] px-4 md:px-6">
            <div class="h-16 flex items-center justify-between gap-3">
                <!-- T√≠tulo + Breadcrumb -->
                <div class="min-w-0 flex-1">
                    <nav class="text-xs text-[color:var(--fg-subtle)]">
                        <ol class="flex items-center gap-2">
                            <li><a class="hover:underline hover:text-[color:var(--fg-muted)]" href="/">Inicio</a></li>
                            <li class="text-[color:var(--fg-subtle)]">/</li>
                            <li class="text-[color:var(--fg-muted)]">Direcciones</li>
                        </ol>
                    </nav>
                    <div class="flex items-center gap-2 mt-1">
                        <h1 class="truncate text-[clamp(18px,2.6vw,24px)] leading-[1.2] font-semibold text-[color:var(--fg)]">
                            Geocodificador de direcciones
                        </h1>
                        <span class="shrink-0 rounded-full px-2 py-0.5 text-xs bg-[color:var(--accent-100)] text-[color:var(--accent)] font-medium">
                            Beta
                        </span>
                    </div>
                </div>

                <!-- META CHIPS (desktop) -->
                <div class="hidden lg:flex items-center gap-2">
                    <span class="rounded-full bg-[color:var(--bg-muted)] text-[color:var(--fg-muted)] text-xs px-2 py-1 border border-[color:var(--brd)]" id="meta-precision">
                        Precisi√≥n: --
                    </span>
                    <span class="rounded-full bg-[color:var(--bg-muted)] text-[color:var(--fg-muted)] text-xs px-2 py-1 border border-[color:var(--brd)]" id="meta-results">
                        Guardadas: 0
                    </span>
                </div>

                <!-- ACCIONES HEADER (desktop) -->
                <div class="hidden md:flex items-center gap-2">
                    <button id="header-clear-btn" class="h-10 px-4 rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] hover:bg-zinc-50 hover:-translate-y-[0.5px] shadow-sm hover:shadow-lg active:translate-y-[1px] transition outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)]">
                        Limpiar
                    </button>
                    <button id="header-center-btn" class="h-10 px-4 rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] hover:bg-zinc-50 hover:-translate-y-[0.5px] shadow-sm hover:shadow-lg active:translate-y-[1px] transition outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)]">
                        Centrar mapa
                    </button>
                    <button id="header-geocode-btn" class="h-10 px-5 rounded-xl bg-[color:var(--accent)] text-white font-medium hover:bg-[color:var(--accent-600)] hover:-translate-y-[0.5px] shadow-md hover:shadow-lg active:translate-y-[1px] transition outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)] disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Geocodificar
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <main class="mx-auto w-full max-w-[1440px] px-4 md:px-6 py-6 md:py-8 space-y-3">
        <!-- Grid Layout: Form + Map + Results -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-0">
            <!-- Left Panel: Form -->
            <div class="lg:col-span-4 lg:pr-6 lg:border-r lg:border-[color:var(--brd)]">
                <div class="bg-[color:var(--bg)] rounded-xl border border-[color:var(--brd)] shadow-[var(--shadow)] overflow-hidden">
                    <!-- Header con patr√≥n de titular de secci√≥n -->
                    <header class="bg-[color:var(--bg-muted)] p-4 md:p-5 border-b border-[color:var(--brd)]">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-[clamp(18px,2.6vw,24px)] leading-[1.2] font-semibold text-[color:var(--fg)]">Direcci√≥n</h2>
                                <p class="mt-1 text-[12px] text-[color:var(--fg-subtle)]">Completa los datos para posicionar el pin</p>
                            </div>
                            <span class="text-[11px] text-[color:var(--fg-subtle)]">* obligatorio</span>
                        </div>
                    </header>

            <form id="geocoding-form" class="p-4 md:p-5 grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Estado -->
                <div class="space-y-1.5">
                    <label for="state" class="text-xs font-medium text-[color:var(--fg-muted)]">Estado</label>
                    <select id="state" name="state"
                            class="h-11 w-full rounded-lg border border-[color:var(--brd)] bg-[color:var(--bg)] px-3 text-[color:var(--fg)] outline-none focus:border-[color:var(--accent)] focus:ring-4 focus:ring-[color:var(--accent-100)] transition"
                            required aria-required="true" aria-describedby="err-state">
                        <option value="">Selecciona un estado</option>
                        <option value="sinaloa" selected>Sinaloa</option>
                        <option value="nuevo-leon">Nuevo Le√≥n</option>
                        <option value="quintana-roo">Quintana Roo</option>
                    </select>
                    <p id="err-state" class="text-[12px] text-[color:var(--err)] hidden" role="alert"></p>
                </div>

                <!-- Municipio -->
                <div class="space-y-1.5">
                    <label for="municipality" class="text-xs font-medium text-zinc-700">Municipio</label>
                    <select id="municipality" name="municipality"
                            class="h-11 w-full rounded-xl border border-zinc-200 bg-white px-3 text-zinc-900 outline-none focus:border-fuchsia-500 focus:ring-4 focus:ring-fuchsia-100 transition disabled:bg-zinc-50 disabled:cursor-not-allowed"
                            required disabled aria-required="true" aria-describedby="err-municipality">
                        <option value="">Ej. Culiac√°n</option>
                    </select>
                    <p id="err-municipality" class="text-[12px] text-rose-700 hidden" role="alert"></p>
                </div>

                <!-- Colonia con icono -->
                <div class="space-y-1.5 form-group autocomplete-wrapper">
                    <label for="colonia" class="text-xs font-medium text-[color:var(--fg-muted)]">Colonia o Fraccionamiento</label>
                    <div class="relative">
                        <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-[color:var(--fg-subtle)]">üèòÔ∏è</span>
                        <input type="text" id="colonia" name="colonia"
                               class="input input--default input-with-icon"
                               placeholder="Ej. Las Quintas"
                               autocomplete="off"
                               required
                               aria-required="true"
                               aria-describedby="err-colonia hint-colonia">
                        <input type="hidden" id="colonia-value" name="coloniaSlug">
                        <div class="autocomplete-suggestions" id="colonia-suggestions"></div>
                    </div>
                    <p class="hint" id="hint-colonia">Escribe al menos 3 caracteres para sugerencias</p>
                    <p id="err-colonia" class="msg-error hidden" role="alert"></p>
                </div>

                <!-- Calle con icono -->
                <div class="space-y-1.5 form-group autocomplete-wrapper">
                    <label for="address" class="text-xs font-medium text-[color:var(--fg-muted)]">Calle</label>
                    <div class="relative">
                        <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-[color:var(--fg-subtle)]">üîé</span>
                        <input type="text" id="address" name="address"
                               class="input input--default input-with-icon"
                               placeholder="Ej. Blvd. Doctor Mora"
                               autocomplete="off"
                               required
                               aria-required="true"
                               aria-describedby="err-address hint-address">
                        <div class="autocomplete-suggestions" id="address-suggestions"></div>
                    </div>
                    <p class="hint" id="hint-address">Autocompleta desde las calles guardadas</p>
                    <p id="err-address" class="msg-error hidden" role="alert"></p>
                </div>

                <!-- N√∫mero Exterior con icono -->
                <div class="space-y-1.5">
                    <label for="exterior-number" class="text-xs font-medium text-[color:var(--fg-muted)]">N√∫mero Exterior</label>
                    <div class="relative">
                        <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-[color:var(--fg-subtle)]">#</span>
                        <input type="text" id="exterior-number" name="exteriorNumber"
                               class="input input--default input-with-icon"
                               placeholder="Ej. 1640"
                               required
                               aria-required="true"
                               aria-describedby="err-exterior-number hint-exterior">
                    </div>
                    <p class="hint" id="hint-exterior">Necesario para precisi√≥n alta</p>
                    <p id="err-exterior-number" class="msg-error hidden" role="alert"></p>
                </div>

                <!-- C√≥digo Postal con m√°scara -->
                <div class="space-y-1.5">
                    <label for="zip-code" class="text-xs font-medium text-[color:var(--fg-muted)]">C√≥digo Postal</label>
                    <div class="relative">
                        <span class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-[color:var(--fg-subtle)]">üìÆ</span>
                        <input type="text" id="zip-code" name="zipCode"
                               inputmode="numeric"
                               pattern="\d{5}"
                               class="input input--default input-with-icon mask-cp"
                               placeholder="80060"
                               maxlength="5"
                               required
                               aria-required="true"
                               aria-describedby="err-zip-code hint-zip">
                    </div>
                    <p class="hint" id="hint-zip">5 d√≠gitos</p>
                    <p id="err-zip-code" class="msg-error hidden" role="alert"></p>
                </div>

                <!-- N√∫mero Interior (opcional, col-span-2) -->
                <div class="space-y-1.5 md:col-span-2">
                    <label for="interior-number" class="text-xs font-medium text-zinc-700">N√∫mero Interior <span class="text-zinc-400">(opcional)</span></label>
                    <input type="text" id="interior-number" name="interiorNumber"
                           class="h-11 w-full rounded-xl border border-zinc-200 bg-white px-3 text-zinc-900 placeholder-zinc-400 outline-none focus:border-fuchsia-500 focus:ring-4 focus:ring-fuchsia-100 transition"
                           placeholder="Ej. Depto 3, Local B">
                </div>

                <!-- Botones -->
                <div class="md:col-span-2 flex items-center gap-3">
                    <button type="submit" id="btn-geocode"
                            class="h-11 px-5 rounded-xl bg-[color:var(--accent)] text-white font-medium shadow-md hover:bg-[color:var(--accent-600)] hover:-translate-y-[0.5px] hover:shadow-lg active:translate-y-[1px] transition disabled:opacity-50 disabled:cursor-not-allowed outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)]"
                            aria-label="Geocodificar direcci√≥n introducida"
                            disabled>
                        <i class="fas fa-search-location mr-2"></i>
                        Geocodificar
                    </button>
                    <button type="button" id="clear-form"
                            class="h-11 px-5 rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] hover:bg-zinc-50 hover:-translate-y-[0.5px] shadow-sm hover:shadow-lg active:translate-y-[1px] transition outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)] focus:border-[color:var(--accent)]"
                            aria-label="Limpiar todos los campos">
                        <i class="fas fa-eraser mr-2"></i>
                        Limpiar
                    </button>
                </div>
            </form>

            <!-- Search History Panel -->
            <div id="history-panel" class="mt-6"></div>

            <!-- POI Nearby Panel removed -->

            <!-- Marker Management Panel -->
            <div id="marker-management-panel" class="mt-6" style="display: none;"></div>

            <!-- Results Panel -->
            <div id="results-panel" class="mt-6 bg-emerald-50 rounded-2xl border-2 border-emerald-200 overflow-hidden" style="display: none;">
                <header class="bg-emerald-500 p-4 md:p-5">
                    <div class="flex items-center gap-3 text-white">
                        <div class="h-10 w-10 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                            <i class="fas fa-check-circle text-lg"></i>
                        </div>
                        <h3 class="text-[clamp(18px,2.6vw,24px)] leading-[1.2] font-semibold">Resultados</h3>
                    </div>
                </header>

                <div class="p-4 md:p-5 space-y-4">
                    <div class="bg-white rounded-xl p-4 border border-emerald-200">
                        <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">Direcci√≥n Completa</span>
                        <p class="mt-1 text-sm text-zinc-900 font-medium" id="result-address">-</p>
                    </div>

                    <!-- Informaci√≥n de Negociaci√≥n -->
                    <div id="result-negotiation-section" class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-4 border-2 border-purple-200" style="display: none;">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-handshake text-purple-600"></i>
                            <span class="text-[12px] font-semibold text-purple-700 uppercase tracking-wide">Informaci√≥n de Negociaci√≥n</span>
                        </div>

                        <div class="space-y-2">
                            <div id="result-contact-container" style="display: none;">
                                <p class="text-sm text-zinc-700">
                                    <i class="fas fa-user text-purple-600 mr-2"></i>
                                    <strong>Contacto:</strong> <span id="result-contact">-</span>
                                </p>
                            </div>
                            <div id="result-estimated-value-container" style="display: none;">
                                <p class="text-sm text-zinc-700">
                                    <i class="fas fa-dollar-sign text-green-600 mr-2"></i>
                                    <strong>Valor Estimado:</strong> <span id="result-estimated-value">-</span>
                                </p>
                            </div>
                            <div id="result-offer-container" style="display: none;">
                                <p class="text-sm text-zinc-700">
                                    <i class="fas fa-hand-holding-usd text-orange-600 mr-2"></i>
                                    <strong>Oferta Realizada:</strong> <span id="result-offer">-</span>
                                </p>
                            </div>
                            <div id="result-tag-container" style="display: none;">
                                <p class="text-sm">
                                    <i class="fas fa-tag text-purple-600 mr-2"></i>
                                    <strong>Etiqueta:</strong> <span id="result-tag-badge" class="inline-block px-3 py-1 rounded-full text-xs font-semibold">-</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div class="bg-white rounded-xl p-4 border border-emerald-200">
                            <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">Latitud</span>
                            <code class="block mt-1 text-sm text-zinc-900 font-mono font-bold" id="result-lat">-</code>
                        </div>

                        <div class="bg-white rounded-xl p-4 border border-emerald-200">
                            <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">Longitud</span>
                            <code class="block mt-1 text-sm text-zinc-900 font-mono font-bold" id="result-lng">-</code>
                        </div>

                        <div class="bg-white rounded-xl p-4 border border-emerald-200">
                            <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">C√≥digo Postal</span>
                            <p class="mt-1 text-sm text-zinc-900 font-medium" id="result-zip">-</p>
                        </div>

                        <div class="bg-white rounded-xl p-4 border border-emerald-200">
                            <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">Precisi√≥n</span>
                            <p class="mt-1 text-sm text-zinc-900 font-medium" id="result-accuracy">-</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-4 border border-emerald-200">
                        <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">Servicio Usado</span>
                        <p class="mt-1 text-sm text-zinc-900 font-medium" id="result-service">-</p>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col gap-3 pt-2">
                        <!-- Primera fila: Google Maps + Copiar Coords -->
                        <div class="flex gap-3">
                            <a id="open-in-maps" href="#" target="_blank" class="flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-3 text-sm font-semibold text-white hover:bg-blue-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-blue-500 active:bg-blue-800 transition-all">
                                <i class="fab fa-google"></i>
                                Google Maps
                            </a>

                            <button id="copy-coords" class="flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-emerald-600 px-4 py-3 text-sm font-semibold text-white hover:bg-emerald-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-emerald-500 active:bg-emerald-800 transition-all" aria-label="Copiar coordenadas">
                                <i class="fas fa-copy"></i>
                                Copiar
                            </button>
                        </div>

                        <!-- Segunda fila: Copiar Enlace (Deep-link) -->
                        <button id="btn-share-link" class="w-full inline-flex items-center justify-center gap-2 rounded-xl border-2 border-indigo-600 bg-white px-4 py-3 text-sm font-semibold text-indigo-600 hover:bg-indigo-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-indigo-500 active:bg-indigo-100 transition-all" aria-label="Copiar enlace">
                            <i class="fas fa-share-alt"></i>
                            Compartir
                        </button>
                    </div>
                </div>
            </div>
                </div>
        </div>

        <!-- Center Panel: Map -->
        <div class="lg:col-span-5 lg:px-6">
            <div class="bg-[color:var(--bg)] rounded-xl border border-[color:var(--brd)] shadow-[var(--shadow)] overflow-hidden">
                <header class="bg-[color:var(--bg-muted)] p-4 md:p-5 border-b border-[color:var(--brd)]">
                    <h2 class="text-[clamp(18px,2.6vw,24px)] leading-[1.2] font-semibold text-[color:var(--fg)]">Mapa Interactivo</h2>
                    <p class="mt-1 text-[12px] text-[color:var(--fg-subtle)]">Arrastra el pin para ajustar la ubicaci√≥n</p>
                </header>

                <!-- Mapa con overlay card -->
                <div class="relative">
                    <div id="map" class="w-full h-[520px] rounded-b-2xl" role="application" aria-label="Mapa interactivo de geocodificaci√≥n"></div>

                    <!-- Tarjeta fija sobre el mapa (E1 - shadow-[var(--shadow)]) -->
                    <div id="loc-card" class="pointer-events-auto absolute bottom-4 left-4 w-[340px] max-w-[92vw] rounded-xl bg-white/95 backdrop-blur shadow-[var(--shadow)] border border-[color:var(--brd)] p-4 space-y-3" style="display: none;">
                        <div class="flex items-start gap-2">
                            <div class="mt-0.5 h-2.5 w-2.5 rounded-full bg-[color:var(--ok)]"></div>
                            <div class="flex-1">
                                <h3 class="text-[clamp(16px,2.2vw,20px)] leading-[1.3] font-medium text-[color:var(--fg)]">Ubicaci√≥n encontrada</h3>
                                <p id="addr" class="text-sm text-[color:var(--fg-muted)] mt-1">Av. Doctor Mora 1640, Las Quintas, Culiac√°n</p>
                            </div>
                        </div>

                        <!-- Tip sutil -->
                        <p class="text-[12px] text-[color:var(--fg-muted)] border-l-2 border-[color:var(--brd-strong)] pl-2">Arrastra el pin a la fachada principal</p>

                        <div class="grid grid-cols-1 gap-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-[color:var(--fg-subtle)]">Coordenadas (dec)</span>
                                <code id="coords-dec" class="font-mono text-[color:var(--fg-muted)]">24.814841, -107.369199</code>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-[color:var(--fg-subtle)]">Coordenadas (DMS)</span>
                                <code id="coords-dms" class="font-mono text-[color:var(--fg-muted)]">24¬∞48'53.4"N, 107¬∞22'09.1"W</code>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-[color:var(--fg-subtle)]">CP</span>
                                <span id="cp" class="text-[color:var(--fg-muted)]">80060</span>
                            </div>
                        </div>

                        <div class="flex items-center gap-2">
                            <button id="btn-copy" class="inline-flex items-center justify-center rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] px-3 py-2 text-sm font-medium hover:bg-zinc-50 hover:-translate-y-[0.5px] shadow-sm hover:shadow-lg active:translate-y-[1px] transition-all outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)] focus:border-[color:var(--accent)]">
                                Copiar
                            </button>
                            <button id="btn-use" class="inline-flex items-center justify-center rounded-xl bg-[color:var(--accent)] px-3 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent-600)] hover:-translate-y-[0.5px] shadow-md hover:shadow-lg active:translate-y-[1px] transition-all outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)]">
                                Usar ubicaci√≥n
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="bg-[color:var(--bg-muted)] px-4 md:px-6 py-3 border-t border-[color:var(--brd)] flex flex-wrap gap-4 justify-center text-[12px] text-[color:var(--fg-muted)]">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-map-pin text-[color:var(--accent)]"></i>
                        <span>Ubicaci√≥n geocodificada</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fas fa-hand-pointer text-[color:var(--accent)]"></i>
                        <span>Arrastra para ajustar</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Results List -->
        <aside class="lg:col-span-3 lg:pl-6 lg:border-l lg:border-[color:var(--brd)]">
            <div class="sticky top-20 bg-white rounded-xl border border-[color:var(--brd)] shadow-[var(--shadow)] overflow-hidden">
                <!-- Header con barra de herramientas integrada -->
                <div class="border-b border-[color:var(--brd)]">
                    <header class="px-4 py-3 border-b border-[color:var(--brd)]">
                        <h3 class="text-sm font-semibold text-zinc-900">Resultados</h3>
                        <p class="text-[12px] text-zinc-500 mt-0.5">
                            <span id="results-count">0</span> encontrados ¬∑
                            <span class="text-[color:var(--accent)]">ordenar por cercan√≠a</span>
                        </p>
                    </header>

                    <!-- Barra de herramientas del listado -->
                    <div class="flex items-center gap-2 px-4 py-2 bg-white/95 backdrop-blur">
                        <button class="h-9 px-3 rounded-lg border border-[color:var(--brd)] text-sm text-[color:var(--fg-muted)] hover:bg-zinc-50 hover:text-[color:var(--fg)] transition active:bg-zinc-100">
                            Cercan√≠a
                        </button>
                        <button class="h-9 px-3 rounded-lg border border-[color:var(--brd)] text-sm text-[color:var(--fg-muted)] hover:bg-zinc-50 hover:text-[color:var(--fg)] transition active:bg-zinc-100">
                            Recientes
                        </button>
                        <div class="ml-auto text-[12px] text-zinc-500">
                            Mostrando <span id="results-showing">0</span>
                        </div>
                    </div>
                </div>

                <!-- Lista de resultados con scroll -->
                <div class="h-[calc(100dvh-280px)] overflow-y-auto overscroll-contain divide-y divide-[color:var(--brd)]" id="results-list">
                    <!-- Skeleton (estado de carga) -->
                    <div id="results-skeleton" class="animate-pulse">
                        <div class="px-4 py-3">
                            <div class="h-4 w-2/3 bg-zinc-200 rounded"></div>
                            <div class="mt-2 h-3 w-1/2 bg-zinc-200 rounded"></div>
                        </div>
                        <div class="px-4 py-3">
                            <div class="h-4 w-3/4 bg-zinc-200 rounded"></div>
                            <div class="mt-2 h-3 w-2/5 bg-zinc-200 rounded"></div>
                        </div>
                        <div class="px-4 py-3">
                            <div class="h-4 w-1/2 bg-zinc-200 rounded"></div>
                            <div class="mt-2 h-3 w-1/3 bg-zinc-200 rounded"></div>
                        </div>
                    </div>

                    <!-- Estado vac√≠o -->
                    <div id="results-empty" class="p-6 text-center text-zinc-600" style="display: none;">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-zinc-100 flex items-center justify-center">
                            <i class="fas fa-search text-zinc-400 text-lg"></i>
                        </div>
                        <p class="text-sm font-medium">Sin resultados</p>
                        <p class="text-[12px] text-zinc-500 mt-1">Ajusta colonia o c√≥digo postal</p>
                    </div>

                    <!-- Filas din√°micas (se llenar√°n con JS) -->
                    <div id="results-items">
                        <!-- Ejemplo de fila (esto se generar√° din√°micamente) -->
                        <!--
                        <article class="group cursor-pointer px-4 py-3 border-b border-[color:var(--brd)] hover:bg-zinc-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-[color:var(--accent)]" tabindex="0" data-marker-id="123">
                            <div class="flex items-start justify-between gap-3">
                                <div class="min-w-0 flex-1">
                                    <h4 class="truncate text-[15px] font-medium text-zinc-900">Blvd Dr Mora 1640</h4>
                                    <p class="truncate text-[13px] text-zinc-600">Las Quintas, 80060 ¬∑ Culiac√°n</p>
                                    <div class="mt-1 flex items-center gap-2 text-[12px] text-zinc-500">
                                        <span class="inline-flex items-center gap-1 rounded-full bg-zinc-100 text-zinc-700 px-2 py-0.5 text-[11px]">
                                            <span class="opacity-70">üìç</span> Casa
                                        </span>
                                        <span>Precisi√≥n: Alta</span>
                                        <span>‚Ä¢</span>
                                        <span>200 m</span>
                                    </div>
                                </div>
                                <div class="text-right shrink-0">
                                    <p class="text-[12px] text-zinc-500">Valor</p>
                                    <p class="text-[15px] font-semibold text-zinc-900">$1,200,000</p>
                                </div>
                            </div>
                        </article>
                        -->
                    </div>
                </div>
            </div>
        </aside>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center" style="display: none;">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm mx-4">
            <div class="flex flex-col items-center space-y-4">
                <div class="h-16 w-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"></div>
                <div class="text-center">
                    <p class="text-[clamp(16px,2.2vw,20px)] leading-[1.3] font-medium text-zinc-900">Geocodificando...</p>
                    <p class="text-[12px] text-zinc-500 mt-1">Esto puede tomar unos segundos</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="fixed top-6 right-6 z-50 flex flex-col gap-3 max-w-md"></div>

    <!-- BARRA DE ACCIONES M√ìVIL (sticky bottom) -->
    <div class="fixed inset-x-0 bottom-0 z-40 md:hidden border-t border-[color:var(--brd)] bg-white/95 backdrop-blur pb-[max(8px,env(safe-area-inset-bottom))] shadow-[0_-4px_12px_rgba(0,0,0,0.08)]">
        <div class="px-4 pt-2">
            <div class="flex items-center gap-2">
                <button id="mobile-clear-btn" class="h-11 flex-1 rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] text-sm font-medium hover:bg-zinc-50 shadow-sm active:translate-y-[1px] transition">
                    Limpiar
                </button>
                <button id="mobile-center-btn" class="h-11 flex-1 rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] text-sm font-medium hover:bg-zinc-50 shadow-sm active:translate-y-[1px] transition">
                    Centrar
                </button>
                <button id="mobile-geocode-btn" class="h-11 flex-[1.2] rounded-xl bg-[color:var(--accent)] text-white text-sm font-medium hover:bg-[color:var(--accent-600)] shadow-md active:translate-y-[1px] transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Geocodificar
                </button>
            </div>
        </div>
    </div>

    <!-- Bot√≥n flotante para abrir panel de propiedades etiquetadas -->
    <button id="toggle-tagged-panel">
        <i class="fas fa-tags"></i>
        <span>Propiedades</span>
        <span class="count-badge" id="tagged-count">0</span>
    </button>

    <!-- Panel lateral de propiedades etiquetadas -->
    <div id="tagged-properties-sidebar">
        <div class="tagged-panel-header">
            <h3>
                <i class="fas fa-tags"></i>
                Propiedades Etiquetadas
                <span class="count-badge" id="tagged-count-header">0</span>
            </h3>
            <button class="close-panel-btn" id="close-tagged-panel">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="tagged-panel-content" id="tagged-panel-content">
            <!-- Se llenar√° din√°micamente con JS -->
        </div>
    </div>

    <!-- Modal de edici√≥n -->
    <div class="edit-modal-overlay" id="edit-modal-overlay">
        <div class="edit-modal">
            <div class="edit-modal-header">
                <h3>
                    <i class="fas fa-edit"></i>
                    Editar Propiedad
                </h3>
                <button class="edit-modal-close" id="edit-modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="edit-modal-body" id="edit-modal-body">
                <!-- Se llenar√° din√°micamente con JS -->
            </div>
            <div class="edit-modal-footer">
                <button class="edit-modal-btn edit-modal-btn-cancel" id="edit-modal-cancel">
                    Cancelar
                </button>
                <button class="edit-modal-btn edit-modal-btn-save" id="edit-modal-save">
                    <i class="fas fa-save"></i>
                    Guardar Cambios
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <!-- Custom Scripts -->
    <script src="js/autocomplete.js?v=20251107"></script>
    <script src="js/geocoding.js?v=20251107"></script>
    <script src="js/validation.js?v=20251107"></script>
    <script src="js/marker-manager.js?v=20251107"></script>
    <script src="js/search-history.js?v=20251107"></script>
    <script src="js/results-panel.js?v=20251107"></script>
    <!-- POI nearby JS removed -->
    <script src="js/geocoding-map.js?v=20251107"></script>
    <script src="js/deep-link.js?v=20251107"></script>

    <!-- Header & Mobile Actions Integration -->
    <script>
    (function() {
        // Sincronizar botones del header con formulario
        const formGeocodeBtn = document.getElementById('btn-geocode');
        const formClearBtn = document.getElementById('clear-form');
        const headerGeocodeBtn = document.getElementById('header-geocode-btn');
        const headerClearBtn = document.getElementById('header-clear-btn');
        const headerCenterBtn = document.getElementById('header-center-btn');
        const mobileGeocodeBtn = document.getElementById('mobile-geocode-btn');
        const mobileClearBtn = document.getElementById('mobile-clear-btn');
        const mobileCenterBtn = document.getElementById('mobile-center-btn');

        // Conectar botones del header
        if (headerGeocodeBtn && formGeocodeBtn) {
            headerGeocodeBtn.addEventListener('click', () => formGeocodeBtn.click());
        }
        if (headerClearBtn && formClearBtn) {
            headerClearBtn.addEventListener('click', () => formClearBtn.click());
        }
        if (headerCenterBtn && window.GeocodingMapApp) {
            headerCenterBtn.addEventListener('click', () => {
                if (GeocodingMapApp.marker) {
                    const pos = GeocodingMapApp.marker.getLatLng();
                    GeocodingMapApp.jumpToMarker(pos.lat, pos.lng);
                }
            });
        }

        // Conectar botones m√≥viles
        if (mobileGeocodeBtn && formGeocodeBtn) {
            mobileGeocodeBtn.addEventListener('click', () => formGeocodeBtn.click());
        }
        if (mobileClearBtn && formClearBtn) {
            mobileClearBtn.addEventListener('click', () => formClearBtn.click());
        }
        if (mobileCenterBtn && window.GeocodingMapApp) {
            mobileCenterBtn.addEventListener('click', () => {
                if (GeocodingMapApp.marker) {
                    const pos = GeocodingMapApp.marker.getLatLng();
                    GeocodingMapApp.jumpToMarker(pos.lat, pos.lng);
                }
            });
        }

        // Sincronizar estado disabled
        const syncDisabledState = () => {
            const isDisabled = formGeocodeBtn.disabled;
            if (headerGeocodeBtn) headerGeocodeBtn.disabled = isDisabled;
            if (mobileGeocodeBtn) mobileGeocodeBtn.disabled = isDisabled;
        };

        // Observer para detectar cambios en el bot√≥n del formulario
        if (formGeocodeBtn) {
            const observer = new MutationObserver(syncDisabledState);
            observer.observe(formGeocodeBtn, { attributes: true, attributeFilter: ['disabled'] });
            syncDisabledState(); // Estado inicial
        }

        // Actualizar meta chips
        const updateMetaChips = () => {
            const savedMarkers = JSON.parse(localStorage.getItem('savedMarkers') || '[]');
            const metaResults = document.getElementById('meta-results');
            if (metaResults) {
                metaResults.textContent = `Guardadas: ${savedMarkers.length}`;
            }
        };

        // Actualizar al cargar y cuando cambie localStorage
        updateMetaChips();
        window.addEventListener('storage', updateMetaChips);
        window.addEventListener('markerTagUpdated', updateMetaChips);
        window.addEventListener('markerDeleted', updateMetaChips);

        // Ajustar padding del main en m√≥vil para la barra inferior
        const main = document.querySelector('main');
        if (main && window.innerWidth < 768) {
            main.style.paddingBottom = '80px'; // Espacio para la barra m√≥vil
        }
    })();
    </script>

    <!-- Results Panel Integration -->
    <script>
    (function() {
        // Inicializar el panel de resultados
        const resultsPanel = new ResultsPanelManager();

        // Mostrar skeleton inicialmente
        resultsPanel.showLoading();

        // Ejemplo de datos para testing (esto se reemplazar√° con datos reales del marker-manager)
        setTimeout(() => {
            // Simular resultados de ejemplo
            const exampleResults = [
                {
                    id: 'marker-1',
                    address: 'Blvd Dr Mora 1640',
                    colonia: 'Las Quintas',
                    zipCode: '80060',
                    municipio: 'Culiac√°n',
                    precision: 'ROOFTOP',
                    distance: 200,
                    value: 1200000,
                    type: 'Casa',
                    lat: 24.814841,
                    lng: -107.369199
                },
                {
                    id: 'marker-2',
                    address: 'Av Universidad 1234',
                    colonia: 'Universidad',
                    zipCode: '80010',
                    municipio: 'Culiac√°n',
                    precision: 'RANGE_INTERPOLATED',
                    distance: 450,
                    value: 850000,
                    type: 'Departamento',
                    lat: 24.801234,
                    lng: -107.381234
                }
            ];

            // Renderizar resultados de ejemplo
            // resultsPanel.renderResults(exampleResults);

            // Por ahora mostrar vac√≠o hasta que se integre con marker-manager
            resultsPanel.showEmpty();
        }, 1000);

        // Conectar con eventos de click en filas ‚Üí centrar mapa
        resultsPanel.onRowClick = function(result) {
            console.log('Centrar mapa en:', result);
            if (window.GeocodingMapApp && result.lat && result.lng) {
                GeocodingMapApp.jumpToMarker(result.lat, result.lng);
            }
        };

        // Conectar con eventos de hover en filas ‚Üí highlight pin
        resultsPanel.onRowHover = function(result, isEntering) {
            console.log('Hover en fila:', result.address, isEntering);
            // TODO: Implementar highlight del pin en el mapa
            // Esto requiere acceso al marker layer de Leaflet
        };

        // Escuchar eventos del mapa para sincronizar selecci√≥n de filas
        window.addEventListener('markerSelected', (e) => {
            const markerId = e.detail?.markerId;
            if (markerId) {
                resultsPanel.selectFromMap(markerId);
            }
        });

        // Escuchar cuando se agregan nuevos markers
        window.addEventListener('markerAdded', () => {
            // TODO: Actualizar lista de resultados con todos los markers guardados
            console.log('Marker added, refresh results list');
        });

        // Exponer globalmente para debugging
        window.ResultsPanel = resultsPanel;
    })();
    </script>
</body>
</html>
