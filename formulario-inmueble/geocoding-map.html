<!DOCTYPE html>
<html lang="es" class="antialiased selection:bg-fuchsia-100 selection:text-fuchsia-900">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geocodificaci贸n con Mapa | Cotizador de Inmuebles</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Herramienta de geocodificaci贸n para obtener coordenadas exactas de propiedades en Culiac谩n y Mazatl谩n, Sinaloa.">
    <meta name="keywords" content="geocodificaci贸n, mapa, coordenadas, direcci贸n, Culiac谩n, Mazatl谩n">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">

    <!-- Google Fonts - Inter for UI -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet CSS (OpenStreetMap) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/main.css?v=20250103">
    <link rel="stylesheet" href="css/form.css?v=20250103">
    <link rel="stylesheet" href="css/geocoding-map.css?v=1762324026">
    <link rel="stylesheet" href="css/geocoding-map-modern.css?v=20251106">
    <link rel="stylesheet" href="css/search-history.css?v=20251106">
    <!-- POI nearby CSS removed -->
    <link rel="stylesheet" href="css/property-marker-3d.css?v=20251106">
    <link rel="stylesheet" href="css/saved-markers.css?v=20251106">
    <link rel="stylesheet" href="css/tagged-properties-panel.css?v=20251107">

    <style>
        /*  Design Tokens - Sistema de dise帽o s贸lido y consistente */
        :root {
            /* Colores base */
            --bg: #ffffff;
            --bg-muted: #fafafa;
            --fg: #0a0a0a;
            --fg-muted: #525252;
            --fg-subtle: #a1a1aa;

            /* Accent (fuchsia) */
            --accent: #c026d3;
            --accent-600: #a21caf;
            --accent-100: #fae8ff;

            /* Estados */
            --ok: #16a34a;
            --warn: #eab308;
            --err: #dc2626;
            --info: #2563eb;

            /* Bordes */
            --brd: #e4e4e7;
            --brd-strong: #d4d4d8;

            /* Sombras (escala de elevaci贸n) */
            --shadow: 0 1px 2px rgba(0,0,0,.06), 0 8px 24px rgba(0,0,0,.06);
        }

        /* Additional inline styles for enhanced visual hierarchy */
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f5f5f5;
        }

        ::-webkit-scrollbar-thumb {
            background: #d4d4d4;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a3a3a3;
        }

        /*  UX Mobile: Mejorar tap area de marcadores */
        .leaflet-marker-icon {
            cursor: pointer;
            /* rea t谩ctil m铆nima 44x44px (Apple HIG) */
            min-width: 44px !important;
            min-height: 44px !important;
        }

        /* Popup personalizado */
        .leaflet-popup.property-popup {
            /* Asegurar legibilidad en mobile */
            font-size: 14px;
        }

        .leaflet-popup.property-popup .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            padding: 0;
        }

        .leaflet-popup.property-popup .leaflet-popup-content {
            margin: 0;
            line-height: 1.5;
        }

        /* Bot贸n de cerrar m谩s grande en mobile */
        @media (max-width: 768px) {
            .leaflet-popup-close-button {
                width: 32px !important;
                height: 32px !important;
                font-size: 24px !important;
                line-height: 32px !important;
                padding: 4px !important;
            }
        }

        /* Marcadores guardados con 谩rea t谩ctil c贸moda */
        .saved-property-marker {
            /* rea t谩ctil amplia */
            padding: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .saved-property-marker:hover,
        .saved-property-marker:active {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-[color:var(--bg)] text-[color:var(--fg)] text-[clamp(15px,1.6vw,16px)] leading-[1.55] tracking-[0.005em] font-sans">
    <!-- HEADER STICKY COMPACTO -->
    <header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/75 bg-white/95 border-b border-[color:var(--brd)] shadow-sm">
        <div class="mx-auto max-w-[1100px] px-4 md:px-6">
            <div class="h-16 flex items-center justify-between gap-3">
                <!-- T铆tulo + Breadcrumb -->
                <div class="min-w-0 flex-1">
                    <nav class="text-xs text-[color:var(--fg-subtle)]">
                        <ol class="flex items-center gap-2">
                            <li><a class="hover:underline hover:text-[color:var(--fg-muted)]" href="/">Inicio</a></li>
                            <li class="text-[color:var(--fg-subtle)]">/</li>
                            <li class="text-[color:var(--fg-muted)]">Direcciones</li>
                        </ol>
                    </nav>
                    <div class="flex items-center gap-2 mt-1">
                        <h1 class="truncate text-[clamp(18px,2.6vw,24px)] leading-[1.2] font-semibold text-[color:var(--fg)]">
                            Geocodificador de direcciones
                        </h1>
                        <span class="shrink-0 rounded-full px-2 py-0.5 text-xs bg-[color:var(--accent-100)] text-[color:var(--accent)] font-medium">
                            Beta
                        </span>
                    </div>
                </div>

                <!-- META CHIPS (desktop) -->
                <div class="hidden lg:flex items-center gap-2">
                    <span class="rounded-full bg-[color:var(--bg-muted)] text-[color:var(--fg-muted)] text-xs px-2 py-1 border border-[color:var(--brd)]" id="meta-precision">
                        Precisi贸n: --
                    </span>
                    <span class="rounded-full bg-[color:var(--bg-muted)] text-[color:var(--fg-muted)] text-xs px-2 py-1 border border-[color:var(--brd)]" id="meta-results">
                        Guardadas: 0
                    </span>
                </div>

                <!-- ACCIONES HEADER (desktop) -->
                <div class="hidden md:flex items-center gap-2">
                    <button id="header-clear-btn" class="h-10 px-4 rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] hover:bg-zinc-50 hover:-translate-y-[0.5px] shadow-sm hover:shadow-lg active:translate-y-[1px] transition outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)]">
                        Limpiar
                    </button>
                    <button id="header-center-btn" class="h-10 px-4 rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] hover:bg-zinc-50 hover:-translate-y-[0.5px] shadow-sm hover:shadow-lg active:translate-y-[1px] transition outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)]">
                        Centrar mapa
                    </button>
                    <button id="header-geocode-btn" class="h-10 px-5 rounded-xl bg-[color:var(--accent)] text-white font-medium hover:bg-[color:var(--accent-600)] hover:-translate-y-[0.5px] shadow-md hover:shadow-lg active:translate-y-[1px] transition outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)] disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        Geocodificar
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <main class="mx-auto w-full max-w-[1100px] px-4 md:px-6 py-6 md:py-8 space-y-3">
        <!-- Grid Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 md:gap-8">
            <!-- Left Panel: Form -->
            <div class="lg:col-span-5">
                <div class="bg-[color:var(--bg)] rounded-xl border border-[color:var(--brd)] shadow-[var(--shadow)] overflow-hidden">
                    <!-- Header con patr贸n de titular de secci贸n -->
                    <header class="bg-[color:var(--bg-muted)] p-4 md:p-5 border-b border-[color:var(--brd)]">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-[clamp(18px,2.6vw,24px)] leading-[1.2] font-semibold text-[color:var(--fg)]">Direcci贸n</h2>
                                <p class="mt-1 text-[12px] text-[color:var(--fg-subtle)]">Completa los datos para posicionar el pin</p>
                            </div>
                            <span class="text-[11px] text-[color:var(--fg-subtle)]">* obligatorio</span>
                        </div>
                    </header>

            <form id="geocoding-form" class="p-4 md:p-5 grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Estado -->
                <div class="space-y-1.5">
                    <label for="state" class="text-xs font-medium text-[color:var(--fg-muted)]">Estado</label>
                    <select id="state" name="state"
                            class="h-11 w-full rounded-lg border border-[color:var(--brd)] bg-[color:var(--bg)] px-3 text-[color:var(--fg)] outline-none focus:border-[color:var(--accent)] focus:ring-4 focus:ring-[color:var(--accent-100)] transition"
                            required aria-required="true" aria-describedby="err-state">
                        <option value="">Selecciona un estado</option>
                        <option value="sinaloa" selected>Sinaloa</option>
                        <option value="nuevo-leon">Nuevo Le贸n</option>
                    </select>
                    <p id="err-state" class="text-[12px] text-[color:var(--err)] hidden" role="alert"></p>
                </div>

                <!-- Municipio -->
                <div class="space-y-1.5">
                    <label for="municipality" class="text-xs font-medium text-zinc-700">Municipio</label>
                    <select id="municipality" name="municipality"
                            class="h-11 w-full rounded-xl border border-zinc-200 bg-white px-3 text-zinc-900 outline-none focus:border-fuchsia-500 focus:ring-4 focus:ring-fuchsia-100 transition disabled:bg-zinc-50 disabled:cursor-not-allowed"
                            required disabled aria-required="true" aria-describedby="err-municipality">
                        <option value="">Ej. Culiac谩n</option>
                    </select>
                    <p id="err-municipality" class="text-[12px] text-rose-700 hidden" role="alert"></p>
                </div>

                <!-- Colonia -->
                <div class="space-y-1.5 form-group autocomplete-wrapper">
                    <label for="colonia" class="text-xs font-medium text-zinc-700">Colonia o Fraccionamiento</label>
                    <input type="text" id="colonia" name="colonia"
                           class="h-11 w-full rounded-xl border border-zinc-200 bg-white px-3 text-zinc-900 placeholder-zinc-400 outline-none focus:border-fuchsia-500 focus:ring-4 focus:ring-fuchsia-100 transition"
                           placeholder="Ej. Las Quintas"
                           autocomplete="off"
                           required
                           aria-required="true"
                           aria-describedby="err-colonia">
                    <input type="hidden" id="colonia-value" name="coloniaSlug">
                    <div class="autocomplete-suggestions" id="colonia-suggestions"></div>
                    <p class="text-[11px] text-zinc-500">Escribe al menos 3 caracteres para sugerencias</p>
                    <p id="err-colonia" class="text-[12px] text-rose-700 hidden" role="alert"></p>
                </div>

                <!-- Calle -->
                <div class="space-y-1.5 form-group autocomplete-wrapper">
                    <label for="address" class="text-xs font-medium text-zinc-700">Calle</label>
                    <input type="text" id="address" name="address"
                           class="h-11 w-full rounded-xl border border-zinc-200 bg-white px-3 text-zinc-900 placeholder-zinc-400 outline-none focus:border-fuchsia-500 focus:ring-4 focus:ring-fuchsia-100 transition"
                           placeholder="Ej. Blvd. Doctor Mora"
                           autocomplete="off"
                           required
                           aria-required="true"
                           aria-describedby="err-address">
                    <div class="autocomplete-suggestions" id="address-suggestions"></div>
                    <p class="text-[11px] text-zinc-500">Autocompleta desde las calles guardadas</p>
                    <p id="err-address" class="text-[12px] text-rose-700 hidden" role="alert"></p>
                </div>

                <!-- N煤mero Exterior -->
                <div class="space-y-1.5">
                    <label for="exterior-number" class="text-xs font-medium text-zinc-700">N煤mero Exterior</label>
                    <input type="text" id="exterior-number" name="exteriorNumber"
                           class="h-11 w-full rounded-xl border border-zinc-200 bg-white px-3 text-zinc-900 placeholder-zinc-400 outline-none focus:border-fuchsia-500 focus:ring-4 focus:ring-fuchsia-100 transition"
                           placeholder="Ej. 1640"
                           required
                           aria-required="true"
                           aria-describedby="err-exterior-number">
                    <p id="err-exterior-number" class="text-[12px] text-rose-700 hidden" role="alert"></p>
                </div>

                <!-- C贸digo Postal -->
                <div class="space-y-1.5">
                    <label for="zip-code" class="text-xs font-medium text-zinc-700">C贸digo Postal</label>
                    <input type="text" id="zip-code" name="zipCode"
                           inputmode="numeric"
                           pattern="\d{5}"
                           class="h-11 w-full rounded-xl border border-zinc-200 bg-white px-3 text-zinc-900 placeholder-zinc-400 outline-none focus:border-fuchsia-500 focus:ring-4 focus:ring-fuchsia-100 transition"
                           placeholder="Ej. 80060"
                           maxlength="5"
                           required
                           aria-required="true"
                           aria-describedby="err-zip-code">
                    <p id="err-zip-code" class="text-[12px] text-rose-700 hidden" role="alert"></p>
                </div>

                <!-- N煤mero Interior (opcional, col-span-2) -->
                <div class="space-y-1.5 md:col-span-2">
                    <label for="interior-number" class="text-xs font-medium text-zinc-700">N煤mero Interior <span class="text-zinc-400">(opcional)</span></label>
                    <input type="text" id="interior-number" name="interiorNumber"
                           class="h-11 w-full rounded-xl border border-zinc-200 bg-white px-3 text-zinc-900 placeholder-zinc-400 outline-none focus:border-fuchsia-500 focus:ring-4 focus:ring-fuchsia-100 transition"
                           placeholder="Ej. Depto 3, Local B">
                </div>

                <!-- Botones -->
                <div class="md:col-span-2 flex items-center gap-3">
                    <button type="submit" id="btn-geocode"
                            class="h-11 px-5 rounded-xl bg-[color:var(--accent)] text-white font-medium shadow-md hover:bg-[color:var(--accent-600)] hover:-translate-y-[0.5px] hover:shadow-lg active:translate-y-[1px] transition disabled:opacity-50 disabled:cursor-not-allowed outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)]"
                            aria-label="Geocodificar direcci贸n introducida"
                            disabled>
                        <i class="fas fa-search-location mr-2"></i>
                        Geocodificar
                    </button>
                    <button type="button" id="clear-form"
                            class="h-11 px-5 rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] hover:bg-zinc-50 hover:-translate-y-[0.5px] shadow-sm hover:shadow-lg active:translate-y-[1px] transition outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)] focus:border-[color:var(--accent)]"
                            aria-label="Limpiar todos los campos">
                        <i class="fas fa-eraser mr-2"></i>
                        Limpiar
                    </button>
                </div>
            </form>

            <!-- Search History Panel -->
            <div id="history-panel" class="mt-6"></div>

            <!-- POI Nearby Panel removed -->

            <!-- Marker Management Panel -->
            <div id="marker-management-panel" class="mt-6" style="display: none;"></div>

            <!-- Results Panel -->
            <div id="results-panel" class="mt-6 bg-emerald-50 rounded-2xl border-2 border-emerald-200 overflow-hidden" style="display: none;">
                <header class="bg-emerald-500 p-4 md:p-5">
                    <div class="flex items-center gap-3 text-white">
                        <div class="h-10 w-10 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm">
                            <i class="fas fa-check-circle text-lg"></i>
                        </div>
                        <h3 class="text-[clamp(18px,2.6vw,24px)] leading-[1.2] font-semibold">Resultados</h3>
                    </div>
                </header>

                <div class="p-4 md:p-5 space-y-4">
                    <div class="bg-white rounded-xl p-4 border border-emerald-200">
                        <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">Direcci贸n Completa</span>
                        <p class="mt-1 text-sm text-zinc-900 font-medium" id="result-address">-</p>
                    </div>

                    <!-- Informaci贸n de Negociaci贸n -->
                    <div id="result-negotiation-section" class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-4 border-2 border-purple-200" style="display: none;">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-handshake text-purple-600"></i>
                            <span class="text-[12px] font-semibold text-purple-700 uppercase tracking-wide">Informaci贸n de Negociaci贸n</span>
                        </div>

                        <div class="space-y-2">
                            <div id="result-contact-container" style="display: none;">
                                <p class="text-sm text-zinc-700">
                                    <i class="fas fa-user text-purple-600 mr-2"></i>
                                    <strong>Contacto:</strong> <span id="result-contact">-</span>
                                </p>
                            </div>
                            <div id="result-estimated-value-container" style="display: none;">
                                <p class="text-sm text-zinc-700">
                                    <i class="fas fa-dollar-sign text-green-600 mr-2"></i>
                                    <strong>Valor Estimado:</strong> <span id="result-estimated-value">-</span>
                                </p>
                            </div>
                            <div id="result-offer-container" style="display: none;">
                                <p class="text-sm text-zinc-700">
                                    <i class="fas fa-hand-holding-usd text-orange-600 mr-2"></i>
                                    <strong>Oferta Realizada:</strong> <span id="result-offer">-</span>
                                </p>
                            </div>
                            <div id="result-tag-container" style="display: none;">
                                <p class="text-sm">
                                    <i class="fas fa-tag text-purple-600 mr-2"></i>
                                    <strong>Etiqueta:</strong> <span id="result-tag-badge" class="inline-block px-3 py-1 rounded-full text-xs font-semibold">-</span>
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                        <div class="bg-white rounded-xl p-4 border border-emerald-200">
                            <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">Latitud</span>
                            <code class="block mt-1 text-sm text-zinc-900 font-mono font-bold" id="result-lat">-</code>
                        </div>

                        <div class="bg-white rounded-xl p-4 border border-emerald-200">
                            <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">Longitud</span>
                            <code class="block mt-1 text-sm text-zinc-900 font-mono font-bold" id="result-lng">-</code>
                        </div>

                        <div class="bg-white rounded-xl p-4 border border-emerald-200">
                            <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">C贸digo Postal</span>
                            <p class="mt-1 text-sm text-zinc-900 font-medium" id="result-zip">-</p>
                        </div>

                        <div class="bg-white rounded-xl p-4 border border-emerald-200">
                            <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">Precisi贸n</span>
                            <p class="mt-1 text-sm text-zinc-900 font-medium" id="result-accuracy">-</p>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-4 border border-emerald-200">
                        <span class="text-[12px] font-semibold text-emerald-700 uppercase tracking-wide">Servicio Usado</span>
                        <p class="mt-1 text-sm text-zinc-900 font-medium" id="result-service">-</p>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col gap-3 pt-2">
                        <!-- Primera fila: Google Maps + Copiar Coords -->
                        <div class="flex gap-3">
                            <a id="open-in-maps" href="#" target="_blank" class="flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-3 text-sm font-semibold text-white hover:bg-blue-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-blue-500 active:bg-blue-800 transition-all">
                                <i class="fab fa-google"></i>
                                Google Maps
                            </a>

                            <button id="copy-coords" class="flex-1 inline-flex items-center justify-center gap-2 rounded-xl bg-emerald-600 px-4 py-3 text-sm font-semibold text-white hover:bg-emerald-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-emerald-500 active:bg-emerald-800 transition-all" aria-label="Copiar coordenadas">
                                <i class="fas fa-copy"></i>
                                Copiar
                            </button>
                        </div>

                        <!-- Segunda fila: Copiar Enlace (Deep-link) -->
                        <button id="btn-share-link" class="w-full inline-flex items-center justify-center gap-2 rounded-xl border-2 border-indigo-600 bg-white px-4 py-3 text-sm font-semibold text-indigo-600 hover:bg-indigo-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-indigo-500 active:bg-indigo-100 transition-all" aria-label="Copiar enlace">
                            <i class="fas fa-share-alt"></i>
                            Compartir
                        </button>
                    </div>
                </div>
            </div>
                </div>
        </div>

        <!-- Right Panel: Map -->
        <div class="lg:col-span-7">
            <div class="bg-[color:var(--bg)] rounded-xl border border-[color:var(--brd)] shadow-[var(--shadow)] overflow-hidden">
                <header class="bg-[color:var(--bg-muted)] p-4 md:p-5 border-b border-[color:var(--brd)]">
                    <h2 class="text-[clamp(18px,2.6vw,24px)] leading-[1.2] font-semibold text-[color:var(--fg)]">Mapa Interactivo</h2>
                    <p class="mt-1 text-[12px] text-[color:var(--fg-subtle)]">Arrastra el pin para ajustar la ubicaci贸n</p>
                </header>

                <!-- Mapa con overlay card -->
                <div class="relative">
                    <div id="map" class="w-full h-[520px] rounded-b-2xl" role="application" aria-label="Mapa interactivo de geocodificaci贸n"></div>

                    <!-- Tarjeta fija sobre el mapa (E1 - shadow-[var(--shadow)]) -->
                    <div id="loc-card" class="pointer-events-auto absolute bottom-4 left-4 w-[340px] max-w-[92vw] rounded-xl bg-white/95 backdrop-blur shadow-[var(--shadow)] border border-[color:var(--brd)] p-4 space-y-3" style="display: none;">
                        <div class="flex items-start gap-2">
                            <div class="mt-0.5 h-2.5 w-2.5 rounded-full bg-[color:var(--ok)]"></div>
                            <div class="flex-1">
                                <h3 class="text-[clamp(16px,2.2vw,20px)] leading-[1.3] font-medium text-[color:var(--fg)]">Ubicaci贸n encontrada</h3>
                                <p id="addr" class="text-sm text-[color:var(--fg-muted)] mt-1">Av. Doctor Mora 1640, Las Quintas, Culiac谩n</p>
                            </div>
                        </div>

                        <!-- Tip sutil -->
                        <p class="text-[12px] text-[color:var(--fg-muted)] border-l-2 border-[color:var(--brd-strong)] pl-2">Arrastra el pin a la fachada principal</p>

                        <div class="grid grid-cols-1 gap-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-[color:var(--fg-subtle)]">Coordenadas (dec)</span>
                                <code id="coords-dec" class="font-mono text-[color:var(--fg-muted)]">24.814841, -107.369199</code>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-[color:var(--fg-subtle)]">Coordenadas (DMS)</span>
                                <code id="coords-dms" class="font-mono text-[color:var(--fg-muted)]">24掳48'53.4"N, 107掳22'09.1"W</code>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-[color:var(--fg-subtle)]">CP</span>
                                <span id="cp" class="text-[color:var(--fg-muted)]">80060</span>
                            </div>
                        </div>

                        <div class="flex items-center gap-2">
                            <button id="btn-copy" class="inline-flex items-center justify-center rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] px-3 py-2 text-sm font-medium hover:bg-zinc-50 hover:-translate-y-[0.5px] shadow-sm hover:shadow-lg active:translate-y-[1px] transition-all outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)] focus:border-[color:var(--accent)]">
                                Copiar
                            </button>
                            <button id="btn-use" class="inline-flex items-center justify-center rounded-xl bg-[color:var(--accent)] px-3 py-2 text-sm font-semibold text-white hover:bg-[color:var(--accent-600)] hover:-translate-y-[0.5px] shadow-md hover:shadow-lg active:translate-y-[1px] transition-all outline-none ring-4 ring-transparent focus:ring-[color:var(--accent-100)]">
                                Usar ubicaci贸n
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div class="bg-[color:var(--bg-muted)] px-4 md:px-6 py-3 border-t border-[color:var(--brd)] flex flex-wrap gap-4 justify-center text-[12px] text-[color:var(--fg-muted)]">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-map-pin text-[color:var(--accent)]"></i>
                        <span>Ubicaci贸n geocodificada</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <i class="fas fa-hand-pointer text-[color:var(--accent)]"></i>
                        <span>Arrastra para ajustar</span>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center" style="display: none;">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm mx-4">
            <div class="flex flex-col items-center space-y-4">
                <div class="h-16 w-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"></div>
                <div class="text-center">
                    <p class="text-[clamp(16px,2.2vw,20px)] leading-[1.3] font-medium text-zinc-900">Geocodificando...</p>
                    <p class="text-[12px] text-zinc-500 mt-1">Esto puede tomar unos segundos</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="fixed top-6 right-6 z-50 flex flex-col gap-3 max-w-md"></div>

    <!-- BARRA DE ACCIONES MVIL (sticky bottom) -->
    <div class="fixed inset-x-0 bottom-0 z-40 md:hidden border-t border-[color:var(--brd)] bg-white/95 backdrop-blur pb-[max(8px,env(safe-area-inset-bottom))] shadow-[0_-4px_12px_rgba(0,0,0,0.08)]">
        <div class="px-4 pt-2">
            <div class="flex items-center gap-2">
                <button id="mobile-clear-btn" class="h-11 flex-1 rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] text-sm font-medium hover:bg-zinc-50 shadow-sm active:translate-y-[1px] transition">
                    Limpiar
                </button>
                <button id="mobile-center-btn" class="h-11 flex-1 rounded-xl border border-[color:var(--brd)] bg-white text-[color:var(--fg-muted)] text-sm font-medium hover:bg-zinc-50 shadow-sm active:translate-y-[1px] transition">
                    Centrar
                </button>
                <button id="mobile-geocode-btn" class="h-11 flex-[1.2] rounded-xl bg-[color:var(--accent)] text-white text-sm font-medium hover:bg-[color:var(--accent-600)] shadow-md active:translate-y-[1px] transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Geocodificar
                </button>
            </div>
        </div>
    </div>

    <!-- Bot贸n flotante para abrir panel de propiedades etiquetadas -->
    <button id="toggle-tagged-panel">
        <i class="fas fa-tags"></i>
        <span>Propiedades</span>
        <span class="count-badge" id="tagged-count">0</span>
    </button>

    <!-- Panel lateral de propiedades etiquetadas -->
    <div id="tagged-properties-sidebar">
        <div class="tagged-panel-header">
            <h3>
                <i class="fas fa-tags"></i>
                Propiedades Etiquetadas
                <span class="count-badge" id="tagged-count-header">0</span>
            </h3>
            <button class="close-panel-btn" id="close-tagged-panel">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="tagged-panel-content" id="tagged-panel-content">
            <!-- Se llenar谩 din谩micamente con JS -->
        </div>
    </div>

    <!-- Modal de edici贸n -->
    <div class="edit-modal-overlay" id="edit-modal-overlay">
        <div class="edit-modal">
            <div class="edit-modal-header">
                <h3>
                    <i class="fas fa-edit"></i>
                    Editar Propiedad
                </h3>
                <button class="edit-modal-close" id="edit-modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="edit-modal-body" id="edit-modal-body">
                <!-- Se llenar谩 din谩micamente con JS -->
            </div>
            <div class="edit-modal-footer">
                <button class="edit-modal-btn edit-modal-btn-cancel" id="edit-modal-cancel">
                    Cancelar
                </button>
                <button class="edit-modal-btn edit-modal-btn-save" id="edit-modal-save">
                    <i class="fas fa-save"></i>
                    Guardar Cambios
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <!-- Custom Scripts -->
    <script src="js/autocomplete.js?v=20251107"></script>
    <script src="js/geocoding.js?v=20251107"></script>
    <script src="js/validation.js?v=20251107"></script>
    <script src="js/marker-manager.js?v=20251107"></script>
    <script src="js/search-history.js?v=20251107"></script>
    <!-- POI nearby JS removed -->
    <script src="js/geocoding-map.js?v=20251107"></script>
    <script src="js/deep-link.js?v=20251107"></script>

    <!-- Header & Mobile Actions Integration -->
    <script>
    (function() {
        // Sincronizar botones del header con formulario
        const formGeocodeBtn = document.getElementById('btn-geocode');
        const formClearBtn = document.getElementById('clear-form');
        const headerGeocodeBtn = document.getElementById('header-geocode-btn');
        const headerClearBtn = document.getElementById('header-clear-btn');
        const headerCenterBtn = document.getElementById('header-center-btn');
        const mobileGeocodeBtn = document.getElementById('mobile-geocode-btn');
        const mobileClearBtn = document.getElementById('mobile-clear-btn');
        const mobileCenterBtn = document.getElementById('mobile-center-btn');

        // Conectar botones del header
        if (headerGeocodeBtn && formGeocodeBtn) {
            headerGeocodeBtn.addEventListener('click', () => formGeocodeBtn.click());
        }
        if (headerClearBtn && formClearBtn) {
            headerClearBtn.addEventListener('click', () => formClearBtn.click());
        }
        if (headerCenterBtn && window.GeocodingMapApp) {
            headerCenterBtn.addEventListener('click', () => {
                if (GeocodingMapApp.marker) {
                    const pos = GeocodingMapApp.marker.getLatLng();
                    GeocodingMapApp.jumpToMarker(pos.lat, pos.lng);
                }
            });
        }

        // Conectar botones m贸viles
        if (mobileGeocodeBtn && formGeocodeBtn) {
            mobileGeocodeBtn.addEventListener('click', () => formGeocodeBtn.click());
        }
        if (mobileClearBtn && formClearBtn) {
            mobileClearBtn.addEventListener('click', () => formClearBtn.click());
        }
        if (mobileCenterBtn && window.GeocodingMapApp) {
            mobileCenterBtn.addEventListener('click', () => {
                if (GeocodingMapApp.marker) {
                    const pos = GeocodingMapApp.marker.getLatLng();
                    GeocodingMapApp.jumpToMarker(pos.lat, pos.lng);
                }
            });
        }

        // Sincronizar estado disabled
        const syncDisabledState = () => {
            const isDisabled = formGeocodeBtn.disabled;
            if (headerGeocodeBtn) headerGeocodeBtn.disabled = isDisabled;
            if (mobileGeocodeBtn) mobileGeocodeBtn.disabled = isDisabled;
        };

        // Observer para detectar cambios en el bot贸n del formulario
        if (formGeocodeBtn) {
            const observer = new MutationObserver(syncDisabledState);
            observer.observe(formGeocodeBtn, { attributes: true, attributeFilter: ['disabled'] });
            syncDisabledState(); // Estado inicial
        }

        // Actualizar meta chips
        const updateMetaChips = () => {
            const savedMarkers = JSON.parse(localStorage.getItem('savedMarkers') || '[]');
            const metaResults = document.getElementById('meta-results');
            if (metaResults) {
                metaResults.textContent = `Guardadas: ${savedMarkers.length}`;
            }
        };

        // Actualizar al cargar y cuando cambie localStorage
        updateMetaChips();
        window.addEventListener('storage', updateMetaChips);
        window.addEventListener('markerTagUpdated', updateMetaChips);
        window.addEventListener('markerDeleted', updateMetaChips);

        // Ajustar padding del main en m贸vil para la barra inferior
        const main = document.querySelector('main');
        if (main && window.innerWidth < 768) {
            main.style.paddingBottom = '80px'; // Espacio para la barra m贸vil
        }
    })();
    </script>
</body>
</html>
