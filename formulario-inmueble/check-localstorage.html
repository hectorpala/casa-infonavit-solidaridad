<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificar localStorage - Propiedades Guardadas</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f9fafb;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        h1 {
            color: #111827;
            margin-bottom: 20px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .stat-card {
            padding: 20px;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border-radius: 8px;
        }
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        .property-list {
            margin-top: 20px;
        }
        .property-item {
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #8b5cf6;
        }
        .property-address {
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }
        .property-meta {
            font-size: 14px;
            color: #6b7280;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .tag-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
        }
        .btn-primary {
            background: #8b5cf6;
            color: white;
        }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .actions {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-database"></i> Verificar localStorage - Propiedades Guardadas</h1>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="total-properties">0</div>
                <div class="stat-label">Propiedades Totales</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="with-tags">0</div>
                <div class="stat-label">Con Etiquetas</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="with-contact">0</div>
                <div class="stat-label">Con Contacto</div>
            </div>
        </div>

        <div class="property-list" id="property-list"></div>

        <div class="actions">
            <button class="btn btn-primary" onclick="window.location.href='geocoding-map.html'">
                <i class="fas fa-map"></i> Ir al Mapa
            </button>
            <button class="btn btn-danger" onclick="clearAllData()">
                <i class="fas fa-trash"></i> Limpiar localStorage
            </button>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'property_markers';

        // Tags disponibles
        const TAGS = {
            'review': { label: 'En revisión', color: '#8b5cf6', bgColor: 'rgba(139, 92, 246, 0.1)' },
            'buy': { label: 'Compra', color: '#10b981', bgColor: 'rgba(16, 185, 129, 0.1)' },
            'sell': { label: 'Venta', color: '#3b82f6', bgColor: 'rgba(59, 130, 246, 0.1)' },
            'flip': { label: 'Posible flip', color: '#a855f7', bgColor: 'rgba(168, 85, 247, 0.1)' },
            'discard': { label: 'Descartada', color: '#6b7280', bgColor: 'rgba(107, 114, 128, 0.1)' }
        };

        function loadProperties() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (!stored) {
                showEmptyState();
                return;
            }

            try {
                const markers = JSON.parse(stored);
                const properties = Object.entries(markers).map(([id, data]) => ({ id, ...data }));

                if (properties.length === 0) {
                    showEmptyState();
                    return;
                }

                // Update stats
                document.getElementById('total-properties').textContent = properties.length;
                document.getElementById('with-tags').textContent = properties.filter(p => p.tag).length;
                document.getElementById('with-contact').textContent = properties.filter(p => p.contact).length;

                // Render properties
                const listContainer = document.getElementById('property-list');
                listContainer.innerHTML = properties.map(property => {
                    const tag = property.tag ? TAGS[property.tag] : null;
                    const tagHTML = tag ? `<span class="tag-badge" style="background-color: ${tag.bgColor}; color: ${tag.color};">${tag.label}</span>` : '';

                    return `
                        <div class="property-item">
                            <div class="property-address">
                                <i class="fas fa-map-marker-alt" style="color: #8b5cf6; margin-right: 8px;"></i>
                                ${property.address || 'Sin dirección'}
                                ${tagHTML}
                            </div>
                            <div class="property-meta">
                                ${property.contact ? `<span><i class="fas fa-user"></i> ${property.contact}</span>` : ''}
                                ${property.phone ? `<span><i class="fas fa-phone"></i> ${property.phone}</span>` : ''}
                                ${property.email ? `<span><i class="fas fa-envelope"></i> ${property.email}</span>` : ''}
                                ${property.estimatedValue ? `<span><i class="fas fa-dollar-sign"></i> ${formatCurrency(property.estimatedValue)}</span>` : ''}
                                ${property.offerAmount ? `<span><i class="fas fa-hand-holding-usd"></i> Oferta: ${formatCurrency(property.offerAmount)}</span>` : ''}
                                <span><i class="fas fa-map-pin"></i> ${property.lat.toFixed(6)}, ${property.lng.toFixed(6)}</span>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error al cargar propiedades:', error);
                showEmptyState('Error al cargar datos');
            }
        }

        function showEmptyState(message = 'No hay propiedades guardadas') {
            const listContainer = document.getElementById('property-list');
            listContainer.innerHTML = `
                <div class="empty-state">
                    <div><i class="fas fa-inbox"></i></div>
                    <div>${message}</div>
                </div>
            `;
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-MX', {
                style: 'currency',
                currency: 'MXN',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function clearAllData() {
            if (confirm('¿Estás seguro de que quieres eliminar TODAS las propiedades guardadas? Esta acción no se puede deshacer.')) {
                localStorage.removeItem(STORAGE_KEY);
                alert('✅ localStorage limpiado exitosamente');
                location.reload();
            }
        }

        // Load on page load
        loadProperties();
    </script>
</body>
</html>
